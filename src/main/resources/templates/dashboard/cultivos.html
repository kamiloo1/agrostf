<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Gesti√≥n de Cultivos | AgroSoft</title>
  <link href="https://cdn.jsdelivr.net/npm/remixicon/fonts/remixicon.css" rel="stylesheet">
  <style>
    :root {
      /* Paleta de colores unificada AgroSoft */
      --verde-oscuro: #0d4f3d;
      --verde-med: #1a7a5e;
      --verde-acento: #2d8659;
      --verde-claro: #e8f5f0;
      --verde-suave: #d4edda;
      --gris-fondo: #f5f7fa;
      --gris-borde: #e9ecef;
      --blanco: #ffffff;
      --texto: #1a1a1a;
      --texto-suave: #495057;
      --sombra: rgba(13, 79, 61, 0.15);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(140deg, var(--gris-fondo) 0%, var(--verde-claro) 50%, #e8f5f0 100%);
      min-height: 100vh;
      display: flex;
      color: var(--texto);
    }

    aside {
      width: 260px;
      background: linear-gradient(160deg, var(--verde-oscuro), #0a3d2d);
      color: var(--blanco);
      padding: 30px 24px;
      display: flex;
      flex-direction: column;
      gap: 24px;
      box-shadow: 12px 0 30px var(--sombra);
      position: sticky;
      top: 0;
      height: 100vh;
    }

    .branding h2 {
      font-family: 'Playfair Display', serif;
      font-size: 28px;
      font-style: italic;
      margin: 0 0 8px;
      letter-spacing: 0.5px;
    }

    .branding span {
      font-size: 14px;
      opacity: 0.8;
    }

    .user-card {
      background: rgba(255,255,255,0.1);
      padding: 18px;
      border-radius: 16px;
      backdrop-filter: blur(6px);
      border: 1px solid rgba(255,255,255,0.05);
    }

    .user-card p {
      margin: 0 0 6px;
      font-weight: 600;
      font-size: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .user-card small {
      display: block;
      opacity: 0.7;
      font-size: 12px;
    }

    nav a {
      display: flex;
      align-items: center;
      gap: 12px;
      color: rgba(255,255,255,0.85);
      text-decoration: none;
      padding: 12px 16px;
      border-radius: 12px;
      margin-bottom: 6px;
      font-weight: 500;
      transition: background 0.3s ease, transform 0.2s ease;
    }

    nav a i {
      font-size: 20px;
    }

    nav a:hover, nav a.active {
      background: rgba(255,255,255,0.18);
      color: #fff;
      transform: translateX(4px);
    }

    main {
      flex: 1;
      padding: 38px 50px;
      overflow-x: hidden;
    }

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 24px;
      margin-bottom: 30px;
    }

    .page-header h1 {
      font-family: 'Playfair Display', serif;
      font-size: 34px;
      color: var(--verde-oscuro);
      margin: 0;
    }

    .page-header h1 span {
      font-size: 16px;
      display: block;
      font-family: 'Roboto', sans-serif;
      font-style: normal;
      color: rgba(27, 94, 32, 0.7);
      margin-top: 4px;
    }

    .header-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .header-actions button {
      background: #fff;
      border: 1px solid rgba(46, 125, 50, 0.2);
      color: var(--verde-med);
      padding: 10px 18px;
      border-radius: 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 500;
      box-shadow: 0 6px 20px rgba(46, 125, 50, 0.08);
      transition: all 0.3s ease;
    }

    .header-actions button.primary {
      background: linear-gradient(135deg, var(--verde-med), #66bb6a);
      color: #fff;
      border: none;
    }

    .header-actions button:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 32px rgba(46, 125, 50, 0.18);
    }

    .floating-leaf {
      position: absolute;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(165, 214, 167, 0.32), transparent 70%);
      pointer-events: none;
      animation: sway 10s ease-in-out infinite;
      filter: blur(0.2px);
      z-index: 0;
    }

    .floating-leaf.leaf-1 { top: 12%; left: 6%; width: 160px; height: 160px; animation-delay: 0s; }
    .floating-leaf.leaf-2 { bottom: 18%; right: 8%; width: 220px; height: 220px; animation-delay: 2.6s; }
    .floating-leaf.leaf-3 { top: 40%; right: 18%; width: 120px; height: 120px; animation-delay: 4.2s; }

    @keyframes sway {
      0%, 100% { transform: translate3d(0,0,0) scale(1); opacity: 0.45; }
      50% { transform: translate3d(14px,-18px,0) scale(1.08); opacity: 0.75; }
    }

    .season-panel {
      position: relative;
      background: linear-gradient(135deg, rgba(46, 125, 50, 0.12), rgba(79, 195, 247, 0.12), rgba(255, 241, 118, 0.14));
      border-radius: 28px;
      padding: 26px 30px;
      margin-bottom: 32px;
      overflow: hidden;
      display: grid;
      gap: 24px;
      box-shadow: 0 28px 46px rgba(27, 94, 32, 0.12);
      border: 1px solid rgba(46, 125, 50, 0.1);
    }

    .season-hero {
      position: relative;
      z-index: 1;
      display: grid;
      gap: 18px;
    }

    .season-hero h2 {
      margin: 0;
      font-family: 'Playfair Display', serif;
      font-size: 30px;
      color: var(--verde-oscuro);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .season-hero p {
      margin: 0;
      font-size: 15px;
      color: rgba(43, 78, 65, 0.82);
      max-width: 640px;
      line-height: 1.5;
    }

    .season-badges {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .season-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px;
      border-radius: 999px;
      background: rgba(255,255,255,0.85);
      color: var(--verde-med);
      font-weight: 600;
      font-size: 12px;
      letter-spacing: 0.6px;
      box-shadow: inset 0 0 0 1px rgba(46, 125, 50, 0.18);
    }

    .season-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .season-actions button {
      border: none;
      border-radius: 14px;
      padding: 10px 18px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      background: rgba(255, 255, 255, 0.92);
      color: var(--verde-med);
      box-shadow: 0 14px 30px rgba(46, 125, 50, 0.14);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .season-actions button.primary {
      background: linear-gradient(135deg, #43a047, #66bb6a);
      color: #fff;
    }

    .season-actions button:hover {
      transform: translateY(-2px);
      box-shadow: 0 20px 36px rgba(36, 90, 54, 0.18);
    }

    .season-metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));
      gap: 18px;
      position: relative;
      z-index: 1;
    }

    .season-card {
      background: rgba(255,255,255,0.9);
      border-radius: 22px;
      padding: 18px 20px;
      box-shadow: 0 18px 34px rgba(27, 94, 32, 0.14);
      border: 1px solid rgba(46, 125, 50, 0.12);
      display: grid;
      gap: 6px;
    }

    .season-card span.label {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.6px;
      color: rgba(41, 94, 60, 0.7);
      font-weight: 600;
    }

    .season-card strong {
      font-size: 26px;
      color: var(--verde-oscuro);
      font-weight: 700;
    }

    .season-card small {
      font-size: 12px;
      color: rgba(43, 78, 65, 0.7);
    }

    .season-mood {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(255,255,255,0.88);
      border-radius: 18px;
      padding: 14px 18px;
      gap: 14px;
      box-shadow: inset 0 0 0 1px rgba(46, 125, 50, 0.14);
      position: relative;
      z-index: 1;
    }

    .season-mood p {
      margin: 0;
      font-size: 15px;
      color: rgba(30, 70, 50, 0.85);
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
    }

    #refreshSeasonMessage {
      border: none;
      border-radius: 12px;
      padding: 10px 16px;
      background: rgba(46,125,50,0.16);
      color: var(--verde-med);
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    #refreshSeasonMessage:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 24px rgba(46, 125, 50, 0.16);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: rgba(255,255,255,0.9);
      border-radius: 20px;
      padding: 22px;
      box-shadow: var(--sombra);
      border: 1px solid rgba(46, 125, 50, 0.12);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .stat-card header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .stat-card header i {
      font-size: 28px;
      color: var(--verde-med);
      background: rgba(46, 125, 50, 0.12);
      padding: 10px;
      border-radius: 12px;
    }

    .stat-card h3 {
      margin: 0;
      font-size: 14px;
      font-weight: 500;
      color: rgba(27, 94, 32, 0.7);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .stat-card strong {
      font-size: 30px;
      font-weight: 700;
      color: var(--verde-oscuro);
    }

    .stat-trend {
      font-size: 12px;
      color: var(--verde-med);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .filters-panel {
      background: #ffffff;
      border-radius: 20px;
      padding: 24px;
      box-shadow: var(--sombra);
      border: 1px solid rgba(46, 125, 50, 0.12);
      margin-bottom: 30px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      position: relative;
    }

    .filters-panel::before {
      content: 'Filtros din√°micos';
      position: absolute;
      top: -12px;
      left: 24px;
      background: var(--verde-med);
      color: #fff;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      letter-spacing: 0.5px;
    }

    .filters-panel label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 6px;
      color: rgba(27, 94, 32, 0.75);
    }

    .filters-panel input,
    .filters-panel select {
      width: 100%;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid rgba(46, 125, 50, 0.2);
      background: rgba(255,255,255,0.9);
      font-size: 14px;
      transition: border 0.3s ease, box-shadow 0.3s ease;
    }

    .filters-panel input:focus,
    .filters-panel select:focus {
      outline: none;
      border-color: var(--verde-med);
      box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.2);
    }

    .filters-panel .filter-actions {
      display: flex;
      gap: 12px;
      align-items: flex-end;
      justify-content: flex-end;
    }

    .filters-panel .filter-actions button {
      background: var(--verde-med);
      color: #fff;
      border: none;
      padding: 12px 18px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .filters-panel .filter-actions button.secondary {
      background: rgba(46, 125, 50, 0.12);
      color: var(--verde-med);
    }

    .quick-chips {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 12px 0 28px;
      flex-wrap: wrap;
    }

    .quick-chips span {
      font-size: 13px;
      font-weight: 600;
      color: rgba(27, 94, 32, 0.75);
    }

    .quick-chips .chips {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .quick-chips button {
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      background: rgba(46, 125, 50, 0.14);
      color: var(--verde-med);
      box-shadow: 0 10px 20px rgba(27, 94, 32, 0.12);
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .quick-chips button.active {
      background: linear-gradient(135deg, var(--verde-med), var(--verde-acento));
      color: #fff;
      box-shadow: 0 16px 28px rgba(27, 94, 32, 0.22);
    }

    .table-wrapper {
      background: rgba(255,255,255,0.95);
      border-radius: 24px;
      box-shadow: var(--sombra);
      border: 1px solid rgba(46, 125, 50, 0.12);
      overflow: hidden;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    thead tr {
      background: linear-gradient(135deg, var(--verde-oscuro), var(--verde-med));
      color: #fff;
    }

    thead th {
      padding: 16px 18px;
      text-align: left;
      font-size: 13px;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      font-weight: 500;
    }

    tbody tr {
      border-bottom: 1px solid rgba(76, 175, 80, 0.08);
      transition: background 0.2s ease, transform 0.2s ease;
    }

    tbody tr:hover {
      background: rgba(76, 175, 80, 0.08);
      transform: translateY(-1px);
    }

    tbody td {
      padding: 15px 18px;
      font-size: 15px;
      vertical-align: middle;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 13px;
      background: rgba(76, 175, 80, 0.12);
      color: var(--verde-med);
      font-weight: 500;
    }

    .area-indicator {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .area-indicator span {
      font-weight: 600;
      color: var(--verde-oscuro);
    }

    .area-progress {
      width: 100%;
      height: 6px;
      background: rgba(76, 175, 80, 0.15);
      border-radius: 999px;
      overflow: hidden;
    }

    .area-progress .fill {
      height: 100%;
      background: linear-gradient(135deg, var(--verde-med), #81c784);
      border-radius: 999px;
      width: 0;
      transition: width 0.6s ease;
    }

    .actions {
      display: flex;
      gap: 10px;
    }

    .actions button {
      border: none;
      border-radius: 10px;
      padding: 8px 14px;
      cursor: pointer;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .actions button.edit {
      background: rgba(30, 136, 229, 0.12);
      color: #1e88e5;
    }

    .actions button.delete {
      background: rgba(229, 57, 53, 0.12);
      color: #d32f2f;
    }

    .actions button:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }

    .view-toggle {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 26px 0 18px;
      flex-wrap: wrap;
      gap: 16px;
    }

    .view-toggle .toggle-group {
      display: inline-flex;
      background: rgba(223, 243, 223, 0.7);
      padding: 4px;
      border-radius: 999px;
      box-shadow: inset 0 0 0 1px rgba(46, 125, 50, 0.12);
    }

    .view-toggle .toggle-group button {
      border: none;
      padding: 8px 18px;
      border-radius: 999px;
      background: transparent;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      color: var(--verde-med);
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .view-toggle .toggle-group button.active {
      background: linear-gradient(135deg, var(--verde-med), var(--verde-acento));
      color: #fff;
      box-shadow: 0 18px 30px rgba(36, 90, 54, 0.18);
    }

    .view-toggle .view-meta {
      font-size: 12px;
      color: rgba(31, 74, 52, 0.7);
      background: rgba(255,255,255,0.85);
      padding: 8px 14px;
      border-radius: 14px;
      box-shadow: var(--sombra);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .cultivo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
    }

    .cultivo-card {
      background: rgba(255,255,255,0.95);
      border-radius: 24px;
      padding: 22px;
      box-shadow: var(--sombra);
      border: 1px solid rgba(46, 125, 50, 0.12);
      display: grid;
      gap: 16px;
      position: relative;
      overflow: hidden;
    }

    .cultivo-card::after {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 82% -12%, rgba(165, 214, 167, 0.16), transparent 65%);
      pointer-events: none;
    }

    .cultivo-card header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 10px;
      position: relative;
      z-index: 1;
    }

    .cultivo-card header h4 {
      margin: 0;
      font-size: 18px;
      color: var(--verde-oscuro);
    }

    .cultivo-card header span {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(46, 125, 50, 0.14);
      color: var(--verde-med);
      padding: 6px 12px;
      border-radius: 999px;
      font-weight: 600;
      font-size: 12px;
    }

    .cultivo-card .meta {
      display: grid;
      gap: 10px;
      font-size: 13px;
      color: rgba(30, 70, 50, 0.8);
      position: relative;
      z-index: 1;
    }

    .card-progress {
      position: relative;
      background: rgba(46, 125, 50, 0.12);
      border-radius: 999px;
      height: 8px;
      overflow: hidden;
    }

    .card-progress span {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 0;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--verde-med), var(--verde-acento));
      transition: width 0.6s ease;
    }

    .cultivo-card .card-actions {
      display: flex;
      gap: 10px;
      position: relative;
      z-index: 1;
    }

    .cultivo-card .card-actions button {
      border: none;
      border-radius: 12px;
      padding: 8px 14px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .cultivo-card .card-actions button.edit {
      background: rgba(30, 136, 229, 0.14);
      color: #1e88e5;
    }

    .cultivo-card .card-actions button.delete {
      background: rgba(229, 57, 53, 0.14);
      color: #d32f2f;
    }

    .cultivo-card .card-actions button:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.1);
    }

    .hidden {
      display: none !important;
    }

    .form-section {
      background: rgba(255,255,255,0.95);
      border-radius: 20px;
      padding: 28px;
      box-shadow: var(--sombra);
      border: 1px solid rgba(46, 125, 50, 0.12);
      margin-bottom: 30px;
    }

    .form-section h3 {
      margin-top: 0;
      font-size: 20px;
      color: var(--verde-oscuro);
      margin-bottom: 18px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 18px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .form-group label {
      font-size: 13px;
      font-weight: 600;
    }

    .form-group input,
    .form-group textarea {
      border-radius: 12px;
      border: 1px solid rgba(46, 125, 50, 0.2);
      padding: 12px 16px;
      font-size: 14px;
      background: rgba(255,255,255,0.95);
      transition: border 0.3s ease, box-shadow 0.3s ease;
    }

    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }

    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--verde-med);
      box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.2);
    }

    .form-actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }

    .form-actions button {
      border: none;
      border-radius: 12px;
      padding: 12px 20px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .form-actions button.submit {
      background: var(--verde-med);
      color: #fff;
    }

    .form-actions button.clear {
      background: rgba(46,125,50,0.12);
      color: var(--verde-med);
    }

    .edit-form {
      display: none;
    }

    .secondary-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 24px;
      margin-top: 30px;
    }

    .secondary-card {
      background: rgba(255,255,255,0.92);
      border-radius: 20px;
      padding: 22px;
      box-shadow: var(--sombra);
      border: 1px solid rgba(46, 125, 50, 0.12);
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .secondary-card h4 {
      margin: 0;
      font-size: 18px;
      color: var(--verde-oscuro);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .activity-list,
    .task-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .activity-item,
    .task-item {
      background: rgba(76, 175, 80, 0.08);
      border-radius: 12px;
      padding: 12px 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }

    .activity-item span:first-child,
    .task-item span:first-child {
      font-weight: 600;
      color: var(--verde-med);
    }

    .mini-badge {
      background: rgba(255,255,255,0.9);
      color: var(--verde-med);
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
    }

    @media (max-width: 1100px) {
      aside {
        display: none;
      }

      body {
        padding: 20px;
      }

      main {
        padding: 24px;
      }

      .page-header {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>

<div class="floating-leaf leaf-1"></div>
<div class="floating-leaf leaf-2"></div>
<div class="floating-leaf leaf-3"></div>

<aside>
  <div class="branding">
    <h2>AgroSoft</h2>
    <span>Panel de Control de Cultivos</span>
  </div>

  <div class="user-card">
    <p><i class="ri-user-line"></i> <span th:text="${usuario}">Administrador</span></p>
    <small>Coordinador de Producci√≥n</small>
  </div>

  <nav>
    <a th:href="@{/dashboard/administrador}"><i class="ri-dashboard-line"></i>Dashboard General</a>
    <a><i class="ri-plant-line"></i>Siembras programadas</a>
    <a th:href="@{/admin/cultivos}" class="active"><i class="ri-leaf-line"></i>Cultivos</a>
    <a><i class="ri-bar-chart-2-line"></i>An√°lisis</a>
    <a th:href="@{/logout}"><i class="ri-logout-circle-line"></i>Cerrar sesi√≥n</a>
  </nav>
</aside>

<main>
  <header class="page-header">
    <div>
      <h1>
        Gesti√≥n de Cultivos
        <span>Monitorea, planifica y optimiza tus parcelas</span>
      </h1>
    </div>
    <div class="header-actions">
      <button class="secondary" type="button"><i class="ri-download-line"></i> Exportar reporte</button>
      <button class="primary" type="button"><i class="ri-add-line"></i> Registrar cultivo</button>
    </div>
  </header>

  <section class="season-panel">
    <div class="season-hero">
      <h2><i class="ri-leaf-line"></i> Temporada en movimiento</h2>
      <p>Visualiza el pulso de tus parcelas, identifica lotes destacados y mant√©n al equipo alineado con una lectura fresca de lo que ocurre en campo.</p>
      <div class="season-badges">
        <span class="season-badge"><i class="ri-sun-foggy-line"></i> Amanecer templado</span>
        <span class="season-badge"><i class="ri-plant-line"></i> Siembras activas</span>
        <span class="season-badge"><i class="ri-gps-line"></i> Mapa satelital actualizado</span>
      </div>
      <div class="season-actions">
        <button type="button" class="primary"><i class="ri-compass-3-line"></i> Abrir plan maestro</button>
        <button type="button"><i class="ri-map-pin-2-line"></i> Ver mapa de parcelas</button>
      </div>
    </div>
    <div class="season-metrics">
      <article class="season-card">
        <span class="label">Lotes activos</span>
        <strong data-highlight-total="true">0</strong>
        <small>Registros sincronizados hoy</small>
      </article>
      <article class="season-card">
        <span class="label">Superficie productiva</span>
        <strong data-highlight-area="true">0 m¬≤</strong>
        <small>Total consolidado en monitoreo</small>
      </article>
      <article class="season-card">
        <span class="label">Diversidad</span>
        <strong data-highlight-diversity="true">0 tipos</strong>
        <small>Cat√°logo activo en esta temporada</small>
      </article>
      <article class="season-card">
        <span class="label">Lote destacado</span>
        <strong data-highlight-largest="true">‚Äî</strong>
        <small>Mayor superficie disponible</small>
      </article>
    </div>
    <div class="season-mood">
      <p><span>üå§Ô∏è</span><span data-season-message>Actualiza condiciones y comparte los logros del d√≠a.</span></p>
      <button type="button" id="refreshSeasonMessage"><i class="ri-shuffle-line"></i> Cambiar √°nimo</button>
    </div>
  </section>

  <section class="stats-grid">
    <article class="stat-card">
      <header>
        <h3>Total de cultivos</h3>
        <i class="ri-seedling-line"></i>
      </header>
      <strong data-stat="total-cultivos">0</strong>
      <span class="stat-trend"><i class="ri-arrow-up-s-line"></i>Balance general actualizado</span>
    </article>

    <article class="stat-card">
      <header>
        <h3>√Årea total monitoreada</h3>
        <i class="ri-landscape-line"></i>
      </header>
      <strong data-stat="area-total">0 m¬≤</strong>
      <span class="stat-trend"><i class="ri-ruler-line"></i>Incluye superficies activas y en preparaci√≥n</span>
    </article>

    <article class="stat-card">
      <header>
        <h3>Tipos distintos</h3>
        <i class="ri-stack-line"></i>
      </header>
      <strong data-stat="tipos-distintos">0</strong>
      <span class="stat-trend"><i class="ri-leaf-line"></i>Diversidad en producci√≥n actual</span>
    </article>

    <article class="stat-card">
      <header>
        <h3>Mayor superficie</h3>
        <i class="ri-focus-2-line"></i>
      </header>
      <strong data-stat="mayor-area">0 m¬≤</strong>
      <span class="stat-trend" data-stat="mayor-area-nombre">Cultivo destacado</span>
    </article>
  </section>

  <section class="filters-panel">
    <div>
      <label for="searchInput">Buscar cultivo</label>
      <input id="searchInput" type="text" placeholder="Ej: Ma√≠z, Tomate, Cosecha Lote 5">
    </div>
    <div>
      <label for="filterTipo">Filtrar por tipo</label>
      <select id="filterTipo">
        <option value="all">Todos los tipos</option>
      </select>
    </div>
    <div>
      <label for="filterArea">√Årea m√≠nima (m¬≤)</label>
      <input id="filterArea" type="number" min="0" step="0.1" placeholder="Ej: 10">
    </div>
    <div class="filter-actions">
      <button type="button" id="applyFilters"><i class="ri-filter-3-line"></i> Aplicar filtros</button>
      <button type="button" id="clearFilters" class="secondary"><i class="ri-refresh-line"></i> Limpiar</button>
    </div>
  </section>

  <div class="quick-chips">
    <span>Explorar r√°pidamente:</span>
    <div class="chips">
      <button type="button" data-chip="hortalizas"><i class="ri-restaurant-line"></i> Hortalizas</button>
      <button type="button" data-chip="granos"><i class="ri-stack-line"></i> Granos</button>
      <button type="button" data-chip="grandes"><i class="ri-focus-2-line"></i> Parcelas grandes</button>
      <button type="button" data-chip="rotacion"><i class="ri-refresh-line"></i> En rotaci√≥n</button>
      <button type="button" data-chip="prioridad"><i class="ri-alert-line"></i> Notas prioritarias</button>
    </div>
  </div>

  <section class="form-section">
    <h3><i class="ri-leaf-line"></i> Registrar nuevo cultivo</h3>
    <form method="post" th:action="@{/admin/cultivos/guardar}">
      <div class="form-grid">
        <div class="form-group">
          <label for="nuevo-nombre">Nombre del cultivo</label>
          <input id="nuevo-nombre" type="text" name="nombre" placeholder="Ej: Ma√≠z H√≠brido Lote 3" required>
        </div>
        <div class="form-group">
          <label for="nuevo-tipo">Tipo o clasificaci√≥n</label>
          <input id="nuevo-tipo" type="text" name="tipo" placeholder="Grano, Hortaliza, Tub√©rculo..." required>
        </div>
        <div class="form-group">
          <label for="nuevo-area">√Årea (m¬≤)</label>
          <input id="nuevo-area" type="number" min="0" step="0.1" name="area" placeholder="Capacidad total de la parcela" required>
        </div>
        <div class="form-group">
          <label for="nuevo-observaciones">Observaciones</label>
          <textarea id="nuevo-observaciones" name="observaciones" placeholder="Notas sobre siembra, variedad, fechas estimadas..."></textarea>
        </div>
      </div>
      <div class="form-actions">
        <button type="submit" class="submit"><i class="ri-check-line"></i> Guardar registro</button>
        <button type="reset" class="clear"><i class="ri-eraser-line"></i> Limpiar campos</button>
      </div>
    </form>
  </section>

  <section id="form-editar" class="form-section edit-form">
    <h3><i class="ri-edit-line"></i> Editar cultivo seleccionado</h3>
    <form method="post" th:action="@{/admin/cultivos/actualizar}">
      <input type="hidden" name="id" id="edit-id">
      <div class="form-grid">
        <div class="form-group">
          <label for="edit-nombre">Nombre</label>
          <input type="text" name="nombre" id="edit-nombre" required>
        </div>
        <div class="form-group">
          <label for="edit-tipo">Tipo</label>
          <input type="text" name="tipo" id="edit-tipo" required>
        </div>
        <div class="form-group">
          <label for="edit-area">√Årea (m¬≤)</label>
          <input type="number" min="0" step="0.1" name="area" id="edit-area" required>
        </div>
        <div class="form-group">
          <label for="edit-observaciones">Observaciones</label>
          <textarea name="observaciones" id="edit-observaciones" placeholder="Notas adicionales del cultivo"></textarea>
        </div>
      </div>
      <div class="form-actions">
        <button type="submit" class="submit"><i class="ri-save-line"></i> Actualizar</button>
        <button type="button" class="clear" id="cancelEdit"><i class="ri-close-line"></i> Cancelar</button>
      </div>
    </form>
  </section>

  <section class="view-toggle">
    <div class="toggle-group">
      <button type="button" data-view="table" class="active"><i class="ri-table-line"></i> Vista tabla</button>
      <button type="button" data-view="cards"><i class="ri-layout-grid-line"></i> Vista tarjetas</button>
    </div>
    <div class="view-meta">
      <i class="ri-focus-3-line"></i> Cambia la vista para analizar tus cultivos como prefieras
    </div>
  </section>

  <section class="table-wrapper" id="tableView">
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Nombre</th>
          <th>Tipo</th>
          <th>√Årea monitoreada</th>
          <th>Notas</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="cultivosTableBody">
        <tr th:each="c : ${cultivos}" 
            th:data-id="${c.idCultivo}"
            th:data-nombre="${c.nombre}"
            th:data-tipo="${c.tipo}"
            th:data-area="${c.area}"
            th:data-observaciones="${c.observaciones}">
          <td>
            <div class="badge">
              <i class="ri-seed-line"></i>
              <span th:text="${c.idCultivo}">1</span>
            </div>
          </td>
          <td th:text="${c.nombre}">Cultivo</td>
          <td>
            <span class="badge" th:text="${c.tipo}">Tipo</span>
          </td>
          <td>
            <div class="area-indicator">
              <span class="area-value" th:text="${c.area} + ' m¬≤'">0 m¬≤</span>
              <div class="area-progress"><div class="fill"></div></div>
            </div>
          </td>
          <td th:text="${c.observaciones} ?: 'Sin observaciones registradas'">Sin observaciones registradas</td>
          <td class="actions">
            <button type="button" class="edit" title="Editar cultivo">
              <i class="ri-edit-line"></i> Editar
            </button>
            <button type="button" class="delete" title="Eliminar cultivo">
              <i class="ri-delete-bin-line"></i> Eliminar
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </section>

  <section id="cardView" class="cultivo-grid hidden">
    <article class="cultivo-card"
             th:each="c : ${cultivos}"
             th:data-id="${c.idCultivo}"
             th:data-nombre="${c.nombre}"
             th:data-tipo="${c.tipo}"
             th:data-area="${c.area}"
             th:data-observaciones="${c.observaciones}">
      <header>
        <h4 th:text="${c.nombre}">Nombre del cultivo</h4>
        <span><i class="ri-price-tag-3-line"></i><span th:text="${c.tipo}">Tipo</span></span>
      </header>
      <div class="meta">
        <div><strong>ID:</strong> <span th:text="${c.idCultivo}">1</span></div>
        <div><strong>√Årea:</strong> <span th:text="${c.area} + ' m¬≤'">0 m¬≤</span></div>
        <div><strong>Notas:</strong> <span th:text="${c.observaciones} ?: 'Sin observaciones registradas'">Sin observaciones registradas</span></div>
        <div>
          <strong>Avance:</strong>
          <div class="card-progress"><span></span></div>
        </div>
      </div>
      <div class="card-actions">
        <button type="button" class="edit"><i class="ri-edit-line"></i> Editar</button>
        <button type="button" class="delete"><i class="ri-delete-bin-line"></i> Eliminar</button>
      </div>
    </article>
  </section>

  <section class="secondary-section">
    <article class="secondary-card">
      <h4><i class="ri-calendar-event-line"></i> Pr√≥ximas actividades sugeridas</h4>
      <div class="activity-list">
        <div class="activity-item">
          <span>Monitoreo riego automatizado</span>
          <span class="mini-badge">24 h</span>
        </div>
        <div class="activity-item">
          <span>Revisi√≥n sanidad en hortalizas</span>
          <span class="mini-badge">48 h</span>
        </div>
        <div class="activity-item">
          <span>Actualizaci√≥n inventario de semillas</span>
          <span class="mini-badge">72 h</span>
        </div>
      </div>
    </article>

    <article class="secondary-card">
      <h4><i class="ri-cloud-line"></i> Condiciones del d√≠a</h4>
      <div class="task-list">
        <div class="task-item">
          <span>Clima templado</span>
          <span class="mini-badge">24¬∞C</span>
        </div>
        <div class="task-item">
          <span>Humedad recomendada</span>
          <span class="mini-badge">65%</span>
        </div>
        <div class="task-item">
          <span>Ventana √≥ptima de fertilizaci√≥n</span>
          <span class="mini-badge">Semana actual</span>
        </div>
      </div>
    </article>

    <article class="secondary-card">
      <h4><i class="ri-lightbulb-line"></i> Recomendaciones</h4>
      <ul class="task-list" style="list-style:none; padding:0; margin:0;">
        <li class="task-item">
          <span>Integra sensores de humedad por parcela</span>
          <span class="mini-badge">Tecnolog√≠a</span>
        </li>
        <li class="task-item">
          <span>Programa alertas para revisiones sanitarias</span>
          <span class="mini-badge">Prevenci√≥n</span>
        </li>
        <li class="task-item">
          <span>Documenta fotos del crecimiento semanal</span>
          <span class="mini-badge">Seguimiento</span>
        </li>
      </ul>
    </article>
  </section>
</main>

<script>
  const tableBody = document.getElementById('cultivosTableBody');
  const tableView = document.getElementById('tableView');
  const cardContainer = document.getElementById('cardView');
  const searchInput = document.getElementById('searchInput');
  const filterTipo = document.getElementById('filterTipo');
  const filterArea = document.getElementById('filterArea');
  const applyButton = document.getElementById('applyFilters');
  const clearButton = document.getElementById('clearFilters');
  const quickChips = Array.from(document.querySelectorAll('.quick-chips button'));
  const viewButtons = document.querySelectorAll('[data-view]');
  const statsElements = {
    total: document.querySelector('[data-stat="total-cultivos"]'),
    area: document.querySelector('[data-stat="area-total"]'),
    tipos: document.querySelector('[data-stat="tipos-distintos"]'),
    mayorArea: document.querySelector('[data-stat="mayor-area"]'),
    mayorNombre: document.querySelector('[data-stat="mayor-area-nombre"]')
  };
  const highlights = {
    total: document.querySelector('[data-highlight-total]'),
    area: document.querySelector('[data-highlight-area]'),
    diversity: document.querySelector('[data-highlight-diversity]'),
    largest: document.querySelector('[data-highlight-largest]')
  };
  const moodMessage = document.querySelector('[data-season-message]');
  const moodButton = document.getElementById('refreshSeasonMessage');
  const cardMap = new Map();

  const seasonMessages = [
    stats => `üå± ${stats.total} cultivos activos listos para una jornada productiva.`,
    stats => stats.averageArea > 0
      ? `üß≠ Promedio de ${stats.averageArea.toFixed(1)} m¬≤ por lote: equilibrio √≥ptimo.`
      : `üß≠ Registra nuevas superficies para darle ritmo a la temporada.`,
    stats => `üçÉ Diversidad en marcha: ${stats.distinctTypes} tipos de cultivo presentes.`,
    stats => `üìç ${stats.largestName} encabeza el lote con ${stats.largestArea.toLocaleString('es-ES', { maximumFractionDigits: 1 })} m¬≤.`,
    stats => `üíß Ajusta riegos seg√∫n tu plan maestro y documenta el progreso con fotos.`
  ];

  let activeChip = null;
  let moodIndex = 0;

  if (cardContainer) {
    cardContainer.querySelectorAll('.cultivo-card').forEach(card => {
      if (card.dataset.id) {
        cardMap.set(card.dataset.id.toString(), card);
      }
    });
  }

  function rows() {
    return tableBody ? Array.from(tableBody.querySelectorAll('tr')) : [];
  }

  function parseArea(value) {
    if (!value) return 0;
    const numeric = parseFloat(value.toString().replace(/[^0-9.,-]/g, '').replace(',', '.'));
    return Number.isNaN(numeric) ? 0 : numeric;
  }

  function gatherStats() {
    const dataRows = rows();
    const stats = {
      total: dataRows.length,
      totalArea: 0,
      distinctTypes: 0,
      largestArea: 0,
      largestName: 'Sin registros',
      averageArea: 0
    };
    const types = new Set();

    dataRows.forEach(row => {
      const area = parseArea(row.dataset.area);
      stats.totalArea += area;
      if (area > stats.largestArea) {
        stats.largestArea = area;
        stats.largestName = row.dataset.nombre || 'Cultivo';
      }
      const tipo = row.dataset.tipo && row.dataset.tipo.trim() ? row.dataset.tipo : 'Sin tipo';
      types.add(tipo);
    });

    stats.distinctTypes = types.size;
    stats.averageArea = stats.total ? stats.totalArea / stats.total : 0;
    return stats;
  }

  function updateStats(stats) {
    if (statsElements.total) statsElements.total.textContent = stats.total;
    if (statsElements.area) statsElements.area.textContent = stats.totalArea.toLocaleString('es-ES', { maximumFractionDigits: 2 }) + ' m¬≤';
    if (statsElements.tipos) statsElements.tipos.textContent = stats.distinctTypes;
    if (statsElements.mayorArea) statsElements.mayorArea.textContent = stats.largestArea.toLocaleString('es-ES', { maximumFractionDigits: 2 }) + ' m¬≤';
    if (statsElements.mayorNombre) statsElements.mayorNombre.textContent = stats.largestName;
  }

  function updateHighlights(stats) {
    if (highlights.total) highlights.total.textContent = stats.total;
    if (highlights.area) highlights.area.textContent = stats.totalArea.toLocaleString('es-ES', { maximumFractionDigits: 1 }) + ' m¬≤';
    if (highlights.diversity) highlights.diversity.textContent = `${stats.distinctTypes} tipos`;
    if (highlights.largest) {
      const detail = stats.largestArea
        ? `${stats.largestName} ‚Ä¢ ${stats.largestArea.toLocaleString('es-ES', { maximumFractionDigits: 1 })} m¬≤`
        : 'Sin registros a√∫n';
      highlights.largest.textContent = detail;
    }
  }

  function updateProgress(visibleOnly = false) {
    const targetRows = visibleOnly ? rows().filter(row => row.style.display !== 'none') : rows();
    const areas = targetRows.map(row => parseArea(row.dataset.area)).filter(area => area > 0);
    const maxArea = areas.length ? Math.max(...areas) : 0;

    rows().forEach(row => {
      const fill = row.querySelector('.area-progress .fill');
      if (!fill) return;
      const area = parseArea(row.dataset.area);
      const width = maxArea > 0 ? Math.max((area / maxArea) * 100, area > 0 ? 6 : 0) : 0;
      fill.style.width = `${width}%`;
    });

    if (cardContainer) {
      cardMap.forEach(card => {
        const bar = card.querySelector('.card-progress span');
        if (!bar) return;
        const area = parseArea(card.dataset.area);
        const width = maxArea > 0 ? Math.max((area / maxArea) * 100, area > 0 ? 8 : 0) : 0;
        bar.style.width = `${width}%`;
      });
    }
  }

  function renderSeasonMessage(stats) {
    if (!moodMessage || !seasonMessages.length) return;
    const generator = seasonMessages[moodIndex % seasonMessages.length];
    moodMessage.textContent = generator ? generator(stats) : '';
  }

  function populateTypeFilter() {
    if (!filterTipo) return;
    const previous = filterTipo.value;
    while (filterTipo.options.length > 1) {
      filterTipo.remove(1);
    }
    const tipos = Array.from(new Set(rows().map(row => row.dataset.tipo || 'Sin tipo'))).sort((a, b) => a.localeCompare(b, 'es'));
    tipos.forEach(tipo => {
      const option = document.createElement('option');
      option.value = tipo;
      option.textContent = tipo;
      filterTipo.appendChild(option);
    });
    if (tipos.includes(previous)) {
      filterTipo.value = previous;
    } else {
      filterTipo.value = 'all';
    }
  }

  function matchesChip(row) {
    if (!activeChip) return true;
    const tipo = (row.dataset.tipo || '').toLowerCase();
    const notas = (row.dataset.observaciones || '').toLowerCase();
    const area = parseArea(row.dataset.area);

    switch (activeChip) {
      case 'hortalizas':
        return tipo.includes('hortal') || tipo.includes('verd') || tipo.includes('veget');
      case 'granos':
        return tipo.includes('grano') || tipo.includes('cereal') || tipo.includes('maiz') || tipo.includes('ma√≠z') || tipo.includes('trigo');
      case 'grandes':
        return area >= 50;
      case 'rotacion':
        return notas.includes('rotac') || notas.includes('descanso') || notas.includes('altern');
      case 'prioridad':
        return notas.includes('prioridad') || notas.includes('urgente') || notas.includes('atenci√≥n') || notas.includes('alerta');
      default:
        return true;
    }
  }

  function applyFilters() {
    const searchValue = (searchInput?.value || '').trim().toLowerCase();
    const tipoValue = filterTipo ? filterTipo.value : 'all';
    const areaValue = filterArea ? parseFloat(filterArea.value) : NaN;

    rows().forEach(row => {
      const nombre = (row.dataset.nombre || '').toLowerCase();
      const notas = (row.dataset.observaciones || '').toLowerCase();
      const tipo = row.dataset.tipo || '';
      const area = parseArea(row.dataset.area);

      const matchesSearch = !searchValue || nombre.includes(searchValue) || notas.includes(searchValue);
      const matchesTipo = tipoValue === 'all' || tipo === tipoValue;
      const matchesArea = Number.isNaN(areaValue) || area >= areaValue;
      const matchesQuick = matchesChip(row);

      const visible = matchesSearch && matchesTipo && matchesArea && matchesQuick;
      row.style.display = visible ? '' : 'none';

      const card = cardMap.get((row.dataset.id || '').toString());
      if (card) {
        card.classList.toggle('hidden', !visible);
      }
    });

    updateProgress(true);
  }

  function openEditForm(data) {
    const formSection = document.getElementById('form-editar');
    if (!formSection) return;
    formSection.style.display = 'block';
    document.getElementById('edit-id').value = data.id || '';
    document.getElementById('edit-nombre').value = data.nombre || '';
    document.getElementById('edit-tipo').value = data.tipo || '';
    document.getElementById('edit-area').value = data.area || '';
    document.getElementById('edit-observaciones').value = data.observaciones || '';
    formSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  function closeEditForm() {
    const formSection = document.getElementById('form-editar');
    if (!formSection) return;
    formSection.style.display = 'none';
    formSection.querySelector('form').reset();
  }

  function deleteCultivo(id, rowElement, cardElement) {
    if (!id) return;
    if (!confirm('¬øEliminar este cultivo? Esta acci√≥n no puede deshacerse.')) return;

    fetch(`/admin/cultivos/eliminar/${id}`, { method: 'DELETE' })
      .then(res => res.json())
      .then(data => {
        if (data.status === 'ok') {
          if (rowElement) rowElement.remove();
          if (cardElement) {
            cardElement.remove();
            cardMap.delete(id.toString());
          }
          populateTypeFilter();
          updateSeasonUI();
          applyFilters();
        } else {
          alert('No fue posible eliminar el cultivo. Intente nuevamente.');
        }
      })
      .catch(() => alert('Error de comunicaci√≥n con el servidor.'));
  }

  function toggleChip(code) {
    if (activeChip === code) {
      activeChip = null;
    } else {
      activeChip = code;
    }
    quickChips.forEach(btn => btn.classList.toggle('active', btn.dataset.chip === activeChip));
    applyFilters();
  }

  function updateSeasonUI() {
    const stats = gatherStats();
    updateStats(stats);
    updateHighlights(stats);
    renderSeasonMessage(stats);
    updateProgress();
  }

  if (tableBody) {
    tableBody.addEventListener('click', event => {
      const button = event.target.closest('button');
      if (!button) return;
      const row = event.target.closest('tr');
      if (!row) return;
      if (button.classList.contains('edit')) {
        openEditForm(row.dataset);
      } else if (button.classList.contains('delete')) {
        const card = cardMap.get((row.dataset.id || '').toString());
        deleteCultivo(row.dataset.id, row, card);
      }
    });
  }

  if (cardContainer) {
    cardContainer.addEventListener('click', event => {
      const button = event.target.closest('button');
      if (!button) return;
      const card = event.target.closest('.cultivo-card');
      if (!card) return;
      if (button.classList.contains('edit')) {
        openEditForm(card.dataset);
      } else if (button.classList.contains('delete')) {
        const row = tableBody ? tableBody.querySelector(`tr[data-id="${card.dataset.id}"]`) : null;
        deleteCultivo(card.dataset.id, row, card);
      }
    });
  }

  quickChips.forEach(btn => {
    btn.addEventListener('click', () => toggleChip(btn.dataset.chip));
  });

  viewButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      if (btn.classList.contains('active')) return;
      viewButtons.forEach(control => control.classList.remove('active'));
      btn.classList.add('active');
      if (btn.dataset.view === 'cards') {
        tableView?.classList.add('hidden');
        cardContainer?.classList.remove('hidden');
      } else {
        cardContainer?.classList.add('hidden');
        tableView?.classList.remove('hidden');
      }
    });
  });

  if (applyButton) {
    applyButton.addEventListener('click', applyFilters);
  }

  if (clearButton) {
    clearButton.addEventListener('click', () => {
      if (searchInput) searchInput.value = '';
      if (filterTipo) filterTipo.value = 'all';
      if (filterArea) filterArea.value = '';
      activeChip = null;
      quickChips.forEach(btn => btn.classList.remove('active'));
      applyFilters();
    });
  }

  if (searchInput) {
    searchInput.addEventListener('input', applyFilters);
  }

  if (filterTipo) {
    filterTipo.addEventListener('change', () => {
      activeChip = null;
      quickChips.forEach(btn => btn.classList.remove('active'));
      applyFilters();
    });
  }

  if (filterArea) {
    filterArea.addEventListener('input', applyFilters);
  }

  const cancelEditButton = document.getElementById('cancelEdit');
  if (cancelEditButton) {
    cancelEditButton.addEventListener('click', closeEditForm);
  }

  if (moodButton) {
    moodButton.addEventListener('click', () => {
      moodIndex = (moodIndex + 1) % seasonMessages.length;
      renderSeasonMessage(gatherStats());
    });
  }

  populateTypeFilter();
  updateSeasonUI();
  applyFilters();
</script>
</body>
</html>
